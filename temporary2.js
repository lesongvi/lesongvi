(function(b){function p(a){return a=1E9<=a?(a/1E9).toFixed(2)+" GB":1E6<=a?(a/1E6).toFixed(2)+" MB":1E3<=a?(a/1E3).toFixed(2)+" KB":1<a?a+" bytes":1==a?a+" byte":"0 byte"}function q(a){30<a.length&&(a=a.slice(0,15)+"..."+a.slice(a.length-10));return a}function c(){if(e.find("li").length){if(!e.find("li.loading").length&&b(".img_bbcode").length){var a=[];e.find("li").each(function(){var f=b(this);f.hasClass("success")?a.push(f.find(".img_bbcode").val()):a.push("L\u1ed7i \u1ea3nh "+f.find("img").data("name"))});
r.val(a.join("\n\n"));t.val(b(".img_bbcode:first").data("thumb"));g.slideDown(function(){u.animate({scrollTop:g.offset().top})})}}else m.click()}var e=b("#img_list"),k=b("#img_upload"),m=b("#img_reset"),n=b("#img_choose_wrap"),g=b("#img_data"),u=b("html,body"),r=b("#img_mess"),t=b("#img_desc"),l=location.search;""!==l&&0===l.indexOf("?postto=")&&b("#img_type").val(l.slice(8));n.on("change","#img_choose",function(){k.prop("disabled",!0);b.each(this.files,function(a,f){if(/^image\/(jpeg|png|bmp|gif)$/.test(this.type)){var d=
f.name;if(!b('img[data-name="'+d+'"]').length){var c=new FileReader,h=new Image;c.readAsDataURL(f);c.onload=function(a){h.src=a.target.result;var c=b("<img>",{src:a.target.result});c.watermark({path:"",
done:function(a){var b=this.width,h=this.height;c.attr({src:a,"class":"watermark","data-width":b,"data-height":h,"data-name":d});e.append(c);c.wrap('<li class="ui-state-default"></li>');c.after('<div class="img_close">close</div><div class="img_details"><p><strong>Name</strong>: '+q(d)+"</p><p><strong>Size</strong>: ("+b+"x"+h+") "+p(f.size)+'</p></div><div class="img_progress_bar"><div class="img_progress"></div></div>')}})}}}});n.html('<input id="img_choose" type="file" multiple accept="image/*" /><span>Ch\u1ecdn \u1ea3nh</span>');
e.sortable({placeholder:"ui-state-highlight",update:function(a,b){c()}}).disableSelection();k.prop("disabled",!1)});k.click(function(){e.find("li:not(.success)").each(function(a,e){var d=b(this),g=d.find("img").attr("src").replace(/data:image\/.+;base64\,/,"");d.removeClass("error").addClass("loading");b.ajax({url:"https://api.imgur.com/3/image",xhr:function(){var a=new window.XMLHttpRequest;a.upload.addEventListener("progress",function(a){a.lengthComputable&&d.find(".img_progress").css({width:a.loaded/
a.total*100+"%"})},!1);return a},method:"POST",headers:{Authorization:"Client-ID 376e1e3bc7aaf7c"},data:{image:g,type:"base64"},success:function(a){var b=a.data.link;d.removeClass("loading").addClass("success");d.find(".img_details").html('<p><input class="img_bbcode" data-thumb="'+b.replace(/(.+)(\.)(png|jpg|gif|bmp)$/,"$1m.$3")+'" onclick="this.select();" type="text" value="[img]'+b+'[/img]" /></p><p><a href="'+b+'" target="_blank">Xem \u1ea3nh</a><a href="http://imgur.com/delete/'+a.data.deletehash+
'" target="_blank">X\u00f3a \u1ea3nh</a></p>');c()},error:function(a){d.removeClass("loading").addClass("error");c();console.warn(a)}})})});m.click(function(){e.empty();g.slideUp()});e.on("click",".img_close",function(){b(this).parent().remove();c()})})(jQuery);
